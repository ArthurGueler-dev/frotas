<!DOCTYPE html>
<html class="light" lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Gerenciamento de Usuários - Sistema de Frotas</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1E3A8A",
                        "background-light": "#F3F4F6",
                        "background-dark": "#1F2937",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    }
                }
            }
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-white">
<div class="relative flex min-h-screen w-full flex-col">
<div class="flex h-full grow flex-row">

<!-- Sidebar Container -->
<div id="sidebar-container" data-page="usuarios"></div>

<main class="flex-1 p-6 lg:p-8 bg-background-light dark:bg-gray-900">
    <div class="flex flex-col gap-6">
        <!-- Header -->
        <div class="flex flex-wrap justify-between items-center gap-4">
            <h1 class="text-gray-900 dark:text-white text-3xl font-black">Gerenciamento de Usuários</h1>
        </div>

        <!-- Tabs -->
        <div class="border-b border-gray-200 dark:border-gray-700">
            <nav class="flex gap-4">
                <button onclick="showTab('usuarios')" id="tab-usuarios"
                    class="tab-btn py-3 px-4 text-sm font-medium border-b-2 border-primary text-primary">
                    Usuários
                </button>
                <button onclick="showTab('perfis')" id="tab-perfis"
                    class="tab-btn py-3 px-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700">
                    Perfis de Acesso
                </button>
            </nav>
        </div>

        <!-- Tab: Usuários -->
        <div id="content-usuarios" class="tab-content">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <h2 class="text-lg font-semibold">Lista de Usuários</h2>
                    <button onclick="openNovoUsuarioModal()" class="flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm font-medium">
                        <span class="material-symbols-outlined text-lg">person_add</span>
                        Novo Usuário
                    </button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-300">
                            <tr>
                                <th class="px-6 py-3">Usuário</th>
                                <th class="px-6 py-3">Nome Completo</th>
                                <th class="px-6 py-3">Perfil</th>
                                <th class="px-6 py-3">Status</th>
                                <th class="px-6 py-3">Último Acesso</th>
                                <th class="px-6 py-3">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="usuarios-tbody">
                            <tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab: Perfis -->
        <div id="content-perfis" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Lista de Perfis -->
                <div class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                        <h2 class="text-lg font-semibold">Perfis</h2>
                    </div>
                    <div id="perfis-list" class="p-2">
                        <p class="text-gray-500 text-center py-4">Carregando...</p>
                    </div>
                </div>

                <!-- Permissões do Perfil Selecionado -->
                <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Permissões: <span id="perfil-selecionado-nome" class="text-primary">-</span></h2>
                        <button onclick="salvarPermissoes()" id="btn-salvar-permissoes" disabled
                            class="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                            <span class="material-symbols-outlined text-lg">save</span>
                            Salvar
                        </button>
                    </div>
                    <div class="p-4">
                        <p id="permissoes-placeholder" class="text-gray-500 text-center py-8">Selecione um perfil para ver as permissões</p>
                        <div id="permissoes-grid" class="hidden">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-200 dark:border-gray-700">
                                        <th class="text-left py-2 px-3">Página</th>
                                        <th class="text-center py-2 px-3 w-24">Acessar</th>
                                        <th class="text-center py-2 px-3 w-24">Editar</th>
                                    </tr>
                                </thead>
                                <tbody id="permissoes-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

</div>
</div>

<!-- Modal: Editar Usuário -->
<div id="modal-usuario" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md mx-4">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
            <h3 class="text-lg font-semibold" id="modal-usuario-titulo">Editar Usuário</h3>
            <button onclick="closeModal('modal-usuario')" class="text-gray-500 hover:text-gray-700">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <form id="form-usuario" class="p-4 space-y-4">
            <input type="hidden" id="edit-user-id"/>

            <div>
                <label class="block text-sm font-medium mb-1">Nome de Usuário</label>
                <input type="text" id="edit-username" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600" readonly/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Nome Completo</label>
                <input type="text" id="edit-fullname" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600" required/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">E-mail</label>
                <input type="email" id="edit-email" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600"/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Perfil de Acesso</label>
                <select id="edit-perfil" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600">
                    <option value="">Sem perfil</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Status</label>
                <select id="edit-status" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600">
                    <option value="ativo">Ativo</option>
                    <option value="pendente">Pendente</option>
                    <option value="inativo">Inativo</option>
                </select>
            </div>

            <div class="flex gap-3 pt-4">
                <button type="button" onclick="closeModal('modal-usuario')" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                    Cancelar
                </button>
                <button type="submit" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">
                    Salvar
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal: Novo Usuário -->
<div id="modal-novo-usuario" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md mx-4">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
            <h3 class="text-lg font-semibold">Novo Usuário</h3>
            <button onclick="closeModal('modal-novo-usuario')" class="text-gray-500 hover:text-gray-700">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <form id="form-novo-usuario" class="p-4 space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Nome Completo *</label>
                <input type="text" id="novo-fullname" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600" required/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Nome de Usuário *</label>
                <input type="text" id="novo-username" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600" required/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">E-mail</label>
                <input type="email" id="novo-email" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600"/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Senha *</label>
                <input type="password" id="novo-senha" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600" required minlength="4"/>
            </div>

            <div>
                <label class="block text-sm font-medium mb-1">Perfil de Acesso</label>
                <select id="novo-perfil" class="w-full px-3 py-2 border rounded-lg bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600">
                    <option value="">Sem perfil</option>
                </select>
            </div>

            <div class="flex gap-3 pt-4">
                <button type="button" onclick="closeModal('modal-novo-usuario')" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                    Cancelar
                </button>
                <button type="submit" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">
                    Criar Usuário
                </button>
            </div>
        </form>
    </div>
</div>

<script>
const API_BASE = 'https://floripa.in9automacao.com.br';
let usuarios = [];
let perfis = [];
let paginas = [];
let perfilSelecionado = null;

// ============================================================================
// INICIALIZAÇÃO
// ============================================================================
document.addEventListener('DOMContentLoaded', async () => {
    await Promise.all([
        carregarUsuarios(),
        carregarPerfis(),
        carregarPaginas()
    ]);

    // Preencher selects de perfil
    preencherSelectsPerfil();
});

// ============================================================================
// TABS
// ============================================================================
function showTab(tab) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
    document.querySelectorAll('.tab-btn').forEach(el => {
        el.classList.remove('border-primary', 'text-primary');
        el.classList.add('border-transparent', 'text-gray-500');
    });

    document.getElementById(`content-${tab}`).classList.remove('hidden');
    const tabBtn = document.getElementById(`tab-${tab}`);
    tabBtn.classList.add('border-primary', 'text-primary');
    tabBtn.classList.remove('border-transparent', 'text-gray-500');
}

// ============================================================================
// CARREGAR DADOS
// ============================================================================
async function carregarUsuarios() {
    try {
        const response = await fetch(`${API_BASE}/users-frotas-api.php?action=list`);
        const result = await response.json();

        if (result.success) {
            usuarios = result.data;
            renderUsuarios();
        }
    } catch (error) {
        console.error('Erro ao carregar usuários:', error);
    }
}

async function carregarPerfis() {
    try {
        const response = await fetch(`${API_BASE}/perfis-api.php?action=list`);
        const result = await response.json();

        if (result.success) {
            perfis = result.data;
            renderPerfis();
        }
    } catch (error) {
        console.error('Erro ao carregar perfis:', error);
    }
}

async function carregarPaginas() {
    try {
        const response = await fetch(`${API_BASE}/perfis-api.php?action=paginas`);
        const result = await response.json();

        if (result.success) {
            paginas = result.paginas;
        }
    } catch (error) {
        console.error('Erro ao carregar páginas:', error);
    }
}

// ============================================================================
// RENDER
// ============================================================================
function renderUsuarios() {
    const tbody = document.getElementById('usuarios-tbody');

    if (usuarios.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">Nenhum usuário encontrado</td></tr>';
        return;
    }

    tbody.innerHTML = usuarios.map(user => {
        const statusBadge = getStatusBadge(user.status);
        const lastLogin = user.last_login_at ? new Date(user.last_login_at).toLocaleString('pt-BR') : 'Nunca';

        return `
            <tr class="bg-white dark:bg-gray-800 border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                <td class="px-6 py-4 font-medium">${user.username}</td>
                <td class="px-6 py-4">${user.full_name || '-'}</td>
                <td class="px-6 py-4">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${user.perfil_nome ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300'}">
                        ${user.perfil_nome || 'Sem perfil'}
                    </span>
                </td>
                <td class="px-6 py-4">${statusBadge}</td>
                <td class="px-6 py-4 text-sm text-gray-500">${lastLogin}</td>
                <td class="px-6 py-4">
                    <button onclick="editarUsuario(${user.id})" class="text-primary hover:text-primary/80 mr-2" title="Editar">
                        <span class="material-symbols-outlined text-xl">edit</span>
                    </button>
                    ${user.id !== 1 ? `
                        <button onclick="excluirUsuario(${user.id}, '${user.username}')" class="text-red-600 hover:text-red-800" title="Excluir">
                            <span class="material-symbols-outlined text-xl">delete</span>
                        </button>
                    ` : ''}
                </td>
            </tr>
        `;
    }).join('');
}

function renderPerfis() {
    const container = document.getElementById('perfis-list');

    container.innerHTML = perfis.map(perfil => `
        <div onclick="selecionarPerfil(${perfil.id})"
             class="perfil-item p-3 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 mb-2 ${perfilSelecionado === perfil.id ? 'bg-primary/10 border-2 border-primary' : 'border border-gray-200 dark:border-gray-600'}"
             data-perfil-id="${perfil.id}">
            <div class="flex justify-between items-start">
                <div>
                    <h4 class="font-medium">${perfil.nome}</h4>
                    <p class="text-xs text-gray-500 mt-1">${perfil.descricao || ''}</p>
                </div>
                <span class="text-xs text-gray-500">${perfil.total_usuarios || 0} usuários</span>
            </div>
        </div>
    `).join('');
}

function getStatusBadge(status) {
    const badges = {
        'ativo': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300">Ativo</span>',
        'pendente': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">Pendente</span>',
        'inativo': '<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300">Inativo</span>'
    };
    return badges[status] || badges['pendente'];
}

function preencherSelectsPerfil() {
    const selects = ['edit-perfil', 'novo-perfil'];
    selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            select.innerHTML = '<option value="">Sem perfil</option>' +
                perfis.map(p => `<option value="${p.id}">${p.nome}</option>`).join('');
        }
    });
}

// ============================================================================
// PERFIS E PERMISSÕES
// ============================================================================
async function selecionarPerfil(perfilId) {
    perfilSelecionado = perfilId;

    // Atualizar visual
    document.querySelectorAll('.perfil-item').forEach(el => {
        el.classList.remove('bg-primary/10', 'border-2', 'border-primary');
        el.classList.add('border', 'border-gray-200', 'dark:border-gray-600');
    });

    const selectedItem = document.querySelector(`[data-perfil-id="${perfilId}"]`);
    if (selectedItem) {
        selectedItem.classList.add('bg-primary/10', 'border-2', 'border-primary');
        selectedItem.classList.remove('border', 'border-gray-200', 'dark:border-gray-600');
    }

    // Carregar permissões
    const perfil = perfis.find(p => p.id == perfilId);
    document.getElementById('perfil-selecionado-nome').textContent = perfil ? perfil.nome : '-';
    document.getElementById('btn-salvar-permissoes').disabled = false;

    try {
        const response = await fetch(`${API_BASE}/perfis-api.php?action=permissoes&perfil_id=${perfilId}`);
        const result = await response.json();

        if (result.success) {
            renderPermissoes(result.permissoes);
        }
    } catch (error) {
        console.error('Erro ao carregar permissões:', error);
    }
}

function renderPermissoes(permissoes) {
    document.getElementById('permissoes-placeholder').classList.add('hidden');
    document.getElementById('permissoes-grid').classList.remove('hidden');

    const tbody = document.getElementById('permissoes-tbody');
    tbody.innerHTML = paginas.map(pagina => {
        const perm = permissoes[pagina.key] || { pode_acessar: false, pode_editar: false };

        return `
            <tr class="border-b border-gray-100 dark:border-gray-700">
                <td class="py-3 px-3">${pagina.nome}</td>
                <td class="py-3 px-3 text-center">
                    <input type="checkbox" data-pagina="${pagina.key}" data-tipo="acessar"
                           ${perm.pode_acessar ? 'checked' : ''}
                           class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary"
                           onchange="onAcessarChange(this)"/>
                </td>
                <td class="py-3 px-3 text-center">
                    <input type="checkbox" data-pagina="${pagina.key}" data-tipo="editar"
                           ${perm.pode_editar ? 'checked' : ''}
                           ${!perm.pode_acessar ? 'disabled' : ''}
                           class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary"/>
                </td>
            </tr>
        `;
    }).join('');
}

function onAcessarChange(checkbox) {
    const pagina = checkbox.dataset.pagina;
    const editarCheckbox = document.querySelector(`input[data-pagina="${pagina}"][data-tipo="editar"]`);

    if (!checkbox.checked) {
        editarCheckbox.checked = false;
        editarCheckbox.disabled = true;
    } else {
        editarCheckbox.disabled = false;
    }
}

async function salvarPermissoes() {
    if (!perfilSelecionado) return;

    const permissoes = {};
    paginas.forEach(pagina => {
        const acessar = document.querySelector(`input[data-pagina="${pagina.key}"][data-tipo="acessar"]`);
        const editar = document.querySelector(`input[data-pagina="${pagina.key}"][data-tipo="editar"]`);

        permissoes[pagina.key] = {
            pode_acessar: acessar?.checked || false,
            pode_editar: editar?.checked || false
        };
    });

    try {
        const response = await fetch(`${API_BASE}/perfis-api.php?action=update_permissoes`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                perfil_id: perfilSelecionado,
                permissoes: permissoes
            })
        });

        const result = await response.json();

        if (result.success) {
            alert('Permissões salvas com sucesso!');
        } else {
            alert('Erro: ' + (result.error || 'Erro ao salvar permissões'));
        }
    } catch (error) {
        console.error('Erro ao salvar permissões:', error);
        alert('Erro ao salvar permissões');
    }
}

// ============================================================================
// MODAIS E FORMULÁRIOS
// ============================================================================
function openModal(modalId) {
    document.getElementById(modalId).classList.remove('hidden');
    document.getElementById(modalId).classList.add('flex');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
    document.getElementById(modalId).classList.remove('flex');
}

function editarUsuario(userId) {
    const user = usuarios.find(u => u.id == userId);
    if (!user) return;

    document.getElementById('edit-user-id').value = user.id;
    document.getElementById('edit-username').value = user.username;
    document.getElementById('edit-fullname').value = user.full_name || '';
    document.getElementById('edit-email').value = user.email || '';
    document.getElementById('edit-perfil').value = user.perfil_id || '';
    document.getElementById('edit-status').value = user.status || 'pendente';

    openModal('modal-usuario');
}

function openNovoUsuarioModal() {
    document.getElementById('form-novo-usuario').reset();
    openModal('modal-novo-usuario');
}

// Form: Editar Usuário
document.getElementById('form-usuario').addEventListener('submit', async (e) => {
    e.preventDefault();

    const userId = document.getElementById('edit-user-id').value;
    const data = {
        full_name: document.getElementById('edit-fullname').value,
        email: document.getElementById('edit-email').value || null,
        perfil_id: document.getElementById('edit-perfil').value || null,
        status: document.getElementById('edit-status').value
    };

    try {
        const response = await fetch(`${API_BASE}/users-frotas-api.php?id=${userId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            closeModal('modal-usuario');
            await carregarUsuarios();
            await carregarPerfis(); // Atualizar contagem
            alert('Usuário atualizado com sucesso!');
        } else {
            alert('Erro: ' + (result.error || 'Erro ao atualizar usuário'));
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao atualizar usuário');
    }
});

// Form: Novo Usuário
document.getElementById('form-novo-usuario').addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
        full_name: document.getElementById('novo-fullname').value,
        username: document.getElementById('novo-username').value,
        email: document.getElementById('novo-email').value || null,
        password: document.getElementById('novo-senha').value,
        user_type: 'usuario'
    };

    try {
        const response = await fetch(`${API_BASE}/users-frotas-api.php?action=register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
            // Atribuir perfil se selecionado
            const perfilId = document.getElementById('novo-perfil').value;
            if (perfilId && result.user && result.user.id) {
                await fetch(`${API_BASE}/users-frotas-api.php?id=${result.user.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ perfil_id: perfilId })
                });
            }

            closeModal('modal-novo-usuario');
            await carregarUsuarios();
            await carregarPerfis();
            alert('Usuário criado com sucesso!');
        } else {
            alert('Erro: ' + (result.error || 'Erro ao criar usuário'));
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao criar usuário');
    }
});

async function excluirUsuario(userId, username) {
    if (!confirm(`Deseja realmente excluir o usuário "${username}"?`)) return;

    try {
        const response = await fetch(`${API_BASE}/users-frotas-api.php?id=${userId}`, {
            method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
            await carregarUsuarios();
            await carregarPerfis();
            alert('Usuário excluído com sucesso!');
        } else {
            alert('Erro: ' + (result.error || 'Erro ao excluir usuário'));
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao excluir usuário');
    }
}
</script>

<!-- Sidebar -->
<script src="auth.js" defer></script>
<script src="sidebar.js?v=20260126"></script>

</body>
</html>
